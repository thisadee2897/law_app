#!/bin/bash

echo "ЁЯФН р╕Др╣Йр╕Щр╕лр╕▓р╣Др╕Яр╕ер╣М .ipa р╣Гр╕Щр╣Вр╕Яр╕ер╣Ар╕Фр╕нр╕гр╣М build..."

# р╕Др╣Йр╕Щр╕лр╕▓р╣Др╕Яр╕ер╣М .ipa
IPA_FILE=$(find build -name "*.ipa" -type f | head -1)

if [ ! -z "$IPA_FILE" ]; then
    echo "тЬЕ р╕Юр╕Ър╣Др╕Яр╕ер╣М .ipa: $IPA_FILE"
    echo "ЁЯУж р╕Др╕▒р╕Фр╕ер╕нр╕Бр╣Др╕Яр╕ер╣Мр╣Др╕Ыр╕вр╕▒р╕З docs/SafeDoc.ipa..."
    cp "$IPA_FILE" docs/SafeDoc.ipa
    echo "ЁЯОЙ р╣Ар╕кр╕гр╣Зр╕Ир╕кр╕┤р╣Йр╕Щ! р╣Др╕Яр╕ер╣Мр╕Юр╕гр╣Йр╕нр╕бр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╣Бр╕ер╣Йр╕з"
    ls -lh docs/SafeDoc.ipa
else
    echo "тЭМ р╣Др╕бр╣Ир╕Юр╕Ър╣Др╕Яр╕ер╣М .ipa"
    echo "ЁЯФз р╕ер╕нр╕Зр╣Гр╕Кр╣Йр╣Др╕Яр╕ер╣М .app р╣Бр╕Чр╕Щ..."
    
    APP_FILE=$(find build -name "Runner.app" -type d | head -1)
    if [ ! -z "$APP_FILE" ]; then
        echo "тЬЕ р╕Юр╕Ър╣Др╕Яр╕ер╣М .app: $APP_FILE"
        echo "тЪая╕П  р╕лр╕бр╕▓р╕вр╣Ар╕лр╕Хр╕╕: р╣Др╕Яр╕ер╣М .app р╣Гр╕Кр╣Йр╣Др╕Фр╣Йр╣Ар╕Йр╕Юр╕▓р╕░р╣Гр╕Щр╣Вр╕лр╕бр╕Фр╕Чр╕Фр╕кр╕нр╕Ър╣Ар╕Чр╣Ир╕▓р╕Щр╕▒р╣Йр╕Щ"
        echo "ЁЯУж р╕кр╕гр╣Йр╕▓р╕З zip file р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╣Бр╕Ир╕Бр╕Ир╣Ир╕▓р╕в..."
        cd "$(dirname "$APP_FILE")"
        zip -r "../SafeDoc.zip" "$(basename "$APP_FILE")"
        cd - > /dev/null
        mv "$(dirname "$APP_FILE")/SafeDoc.zip" docs/SafeDoc.zip
        echo "ЁЯУБ р╕кр╕гр╣Йр╕▓р╕Зр╣Др╕Яр╕ер╣М docs/SafeDoc.zip р╣Бр╕ер╣Йр╕з"
        ls -lh docs/SafeDoc.zip
    else
        echo "тЭМ р╣Др╕бр╣Ир╕Юр╕Ър╣Др╕Яр╕ер╣М .app р╕Фр╣Йр╕зр╕в"
        echo "ЁЯТб р╕ер╕нр╕Зр╕гр╕▒р╕Щр╕Др╕│р╕кр╕▒р╣Ир╕З: flutter build ios --release"
    fi
fi

echo ""
echo "ЁЯУЛ р╕кр╕гр╕╕р╕Ы:"
echo "- р╕лр╕▓р╕Бр╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╕Ир╕гр╕┤р╕З: р╕Хр╣Йр╕нр╕Зр╕бр╕╡р╣Др╕Яр╕ер╣М .ipa р╕Чр╕╡р╣Ир╕ер╕Зр╕Щр╕▓р╕бр╣Бр╕ер╣Йр╕з"
echo "- р╕лр╕▓р╕Бр╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕Чр╕Фр╕кр╕нр╕Ъ: р╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Гр╕Кр╣Йр╣Др╕Яр╕ер╣М .app р╕лр╕гр╕╖р╕н .zip р╣Др╕Фр╣Й"
echo "- р╕Хр╕│р╣Бр╕лр╕Щр╣Ир╕Зр╣Др╕Яр╕ер╣М: docs/SafeDoc.ipa (р╕лр╕гр╕╖р╕н docs/SafeDoc.zip)"
